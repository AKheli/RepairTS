{% load filters %}


<form class="form-group" id="optimization-form">
    {% csrf_token %}
    <div class="kt-portlet">
        <div class="kt-portlet__head">
            <div class="kt-portlet__head-label">
                <h3 class="kt-portlet__head-title">Parameter Search Space</h3>
            </div>
            <div class="kt-portlet__head-toolbar">
                <div class="kt-portlet__head-group">
                    <select class="form-control" id="optFormAlgSelect" name="algorithm" onchange="displayfuncOpt()">
                        {% for alg_name, _ in b_opt_param_forms.items %}
                            <option value={{ alg_name }}> {{ alg_name|parse_alg_name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>
        <div class="kt-portlet__body" style="padding-bottom: 0px;padding-top: 10px">
            {% for alg,params in b_opt_param_forms.items %}
                <div class="form-group alg-param-forms" id='{{ alg }}-form'
                     onchange="return false" onsubmit="return false"
                        {% if forloop.first %}
                     style="display:block;"
                        {% else %}
                     style="display:none;"
                        {% endif %}
                >
                    {% for param in params %}
                        <div style="height: 20px;"></div>
                        <div class="row">
                            {% if param.label|length > 3 %}
                                {% if param.label|length > 8 %}
                                    <div class="col-md-3" style="text-align: end;">
                                        <p style="margin-bottom: 3px; margin-top: 23px; font-weight: bold;">{{ param.label }}:</p>
                                    </div>
                                    <div class="col-md-9">
                                        {% with pa_id=alg|add:"-"|add:param.param_name %}
                                            {% include "parts/double-range-slider.html" with min=param.min max=param.max step=param.step id=pa_id label=param.param_name %}
                                        {% endwith %}
                                    </div>
                                {% else %}
                                    <div class="col-md-2" style="text-align: end;">
                                        <p style="margin-bottom: 3px; margin-top: 23px; font-weight: bold;">{{ param.label }}:</p>
                                    </div>
                                    <div class="col-md-10">
                                        {% with pa_id=alg|add:"-"|add:param.param_name %}
                                            {% include "parts/double-range-slider.html" with min=param.min max=param.max step=param.step id=pa_id label=param.param_name %}
                                        {% endwith %}
                                    </div>
                                {% endif %}
                            {% else %}
                                <div class="col-md-1" style="text-align: end;">
                                    <p style="margin-bottom: 3px; margin-top: 23px;font-weight: bold;">{{ param.label }}:</p>
                                </div>
                                <div class="col-md-11">
                                    {% with pa_id=alg|add:"-"|add:param.param_name %}
                                        {% include "parts/double-range-slider.html" with min=param.min max=param.max step=param.step id=pa_id label=param.param_name %}
                                    {% endwith %}
                                </div>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            {% endfor %}
        </div>
    </div>
    <div  id="bayesian-opt-portlet">
        <div class="kt-portlet" data-ktportlet="true">
            <div class="kt-portlet__head">
                <div class="kt-portlet__head-label">
                    <h3 class="kt-portlet__head-title">
                        Optimization Settings
                    </h3>
                    <div class="kt-portlet__head-toolbar">
                        <div class="kt-portlet__head-group">
                        </div>
                    </div>
                </div>
                <div class="kt-portlet__head-toolbar">
                    <div class="kt-portlet__head-group">
                        <a href="#" data-ktportlet-tool="toggle"
                           class="btn btn-sm btn-icon btn-default btn-icon-md"><i
                                class="mdi mdi-chevron-down mdi-18px"></i></a>
                    </div>
                </div>
            </div>
            <div class="kt-portlet__body">
                <form class="form-group" id="bayesian_opt_form_params" enctype="multipart/form-data">
                    {% for field in bayesian_opt_form %}
                        <div class="form-group">
                            {{ field.label_tag }}
                            {{ field }}
                        </div>
                    {% endfor %}
                </form>
                <div id="form_append_container"></div>
            </div>
        </div>
    </div>
</form>


<script>
    // form display change
    let displayfuncOpt = function () {
        let key = document.getElementById("optFormAlgSelect").value;
        let forms = document.getElementsByClassName("alg-param-forms");
        for (let i = 0; i < forms.length; i++) {
            if (forms[i].id === key + "-form") {
                forms[i].style.display = "block";
            } else {
                forms[i].style.display = "none";
            }
        }
    }


</script>
