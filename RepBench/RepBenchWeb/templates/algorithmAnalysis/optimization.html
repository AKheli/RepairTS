{% extends "displayDataset/displayDatasetSynthetic.html" %}
{% load static %}



{% block  contnet_header %}
    <h2 class="content-header"> Optimization
        {% include "parts/info-box.html" with id="opt-info" %}
    </h2>
    <div class="toggle-page-info" id="opt-info">
        <li>
           Define a parameter space by selecting a lower and upper bound for the parameter values.
        </li>
        <li>
           For large dataset only a subset of the data is used for calibration.
        </li>

    </div>
{% endblock %}


{% block content %}

    <div class="row">

        <div class="col-lg-4">
            {% include 'algorithmAnalysis/bayesianOptForm.html' %}
        </div>
        <div class="col-lg-8">
            <div style="display:block">
                {% block  chartContent %}
                    {% with chartHeight=400 %}
                        {{ block.super }}
                    {% endwith %}
                {% endblock %}
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-6">
            <div class="kt-portlet">
                <div class="kt-portlet__head">
                    <div class="kt-portlet__head-label">
                        <form id="start-form">
                            {% csrf_token %}
                            <button id="play-optimization" type="submit" class="play-btn"
                            >
                                <i class="mdi mdi-24px mdi-play"></i>
                                <i style="display:none" class="mdi mdi-24px mdi-pause"></i>
                            </button>
                            <button id="reload-optimization" type="submit" class="reload-btn"
                            >
                                <i class="mdi mdi-24px mdi-reload"></i>
                                <i style="display:none" class="mdi mdi-24px mdi-pause"></i>
                            </button>
                            <div id="start-button-right" style="display: inline;">
                                <h6 id="play-optimization-info-text" style="display: inline;"></h6>
                            </div>
                        </form>
                    </div>
                    <div class="kt-portlet__head-toolbar">
                        <select class="form-control" id="optimizer-select" name="optimizer" onchange="changeOptimizer()"
                        >
                            <option value="bayesian"> Bayesian Optimisation</option>
                            <option value=successive_halving> Successive Halving</option>
                        </select>
                        <script>
                            let changeOptimizer = function () {
                                optimizationHandler.stopIteration();
                                let selectElement = document.getElementById("optimizer-select");
                                let selectedValue = selectElement.value;
                                let bayesianOptPortlet = document.getElementById("bayesian-opt-portlet");
                                if (selectedValue === "bayesian") {
                                    optimizationHandler.reInit("bayesian", start_bayesian_optimization_url, fetch_opt_result)
                                    bayesianOptPortlet.classList.remove("disabled");
                                } else {
                                    bayesianOptPortlet.classList.add("disabled");
                                    optimizationHandler.reInit("successive_halving", start_successive_halving_url, fetch_opt_result)
                                }
                            }
                        </script>
                    </div>
                </div>

                <div class="kt-portlet__body">
                    <div id="ErrorChart"></div>
                </div>

            </div>
        </div>
     <div class="col-lg-6">
            {#                        {% block blowChartContent %}#}
            <div id="SucessiveHalvingChart">
            </div>
            {% include "algorithmAnalysis/optimization_charts.html" %}
{#                        {% endblock %}#}
        </div>
    </div>


{% endblock %}


{% block additional_bottom_js %}
    <script>
        let start_bayesian_optimization_url = "{% url 'start_bayesian_opt' %}"
        let start_successive_halving_url = "{% url 'start_successive_halving' %}"
        let setname = "{{ setname }}"
        let fetch_opt_result = "{% url 'fetch_optresults' %}"
        let repair_url = "{% url 'repair_data' setname=setname %}"

    </script>
    <script src="{% static 'js/repBench/repair/repair.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/repBench/optimization/optchart.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/repBench/optimization/optimization.js' %}" type="text/javascript"></script>
    {% include "algorithmAnalysis/optimization-script.html" %}
    <script>
        optimizationHandler.init("bayesian", start_bayesian_optimization_url, fetch_opt_result)
    </script>
{% endblock %}

